generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model user {
  id            String   @id
  name          String
  email         String   @unique
  emailVerified Boolean  @default(false)
  image         String?
  role          String   @default("user")
  isActive      Boolean  @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  sessions       session[]
  accounts       account[]
  medicosProfile medicosProfile?

  @@map("users")
}

model session {
  id        String   @id
  expiresAt DateTime @map("expires_at")
  token     String   @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  ipAddress String?  @map("ip_address")
  userAgent String?  @map("user_agent")
  userId    String   @map("user_id")

  user user @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], name: "sessions_userId_idx")
  @@map("sessions")
}

model account {
  id                    String    @id
  accountId             String    @map("account_id")
  providerId            String    @map("provider_id")
  userId                String    @map("user_id")
  accessToken           String?   @map("access_token")
  refreshToken          String?   @map("refresh_token")
  idToken               String?   @map("id_token")
  accessTokenExpiresAt  DateTime? @map("access_token_expires_at")
  refreshTokenExpiresAt DateTime? @map("refresh_token_expires_at")
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  user user @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], name: "accounts_userId_idx")
  @@map("accounts")
}

model verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime @map("expires_at")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@index([identifier], name: "verifications_identifier_idx")
  @@map("verifications")
}

model medicosProfile {
  id                  String   @id @default(uuid())
  userId              String   @unique @map("user_id")
  fullName            String   @map("full_name")
  professionalId      String?  @map("professional_id")
  studentType         String?  @map("student_type")
  universityMatricula String?  @map("university_matricula")
  hospital            String
  otherHospital       String?  @map("other_hospital")
  specialty           String
  userType            String   @map("user_type")
  isEmailVerified     Boolean  @default(false) @map("is_email_verified")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  user            user    @relation(fields: [userId], references: [id], onDelete: Cascade)
  assignedTasks   task[]  @relation("AssignedTasks")
  createdTasks    task[]  @relation("CreatedTasks")

  @@map("medicos_profile")
}

model patient {
  id                      String     @id @default(uuid())
  medicalRecordNumber     String     @unique @map("medical_record_number")
  firstName               String     @map("first_name")
  lastName                String     @map("last_name")
  dateOfBirth             DateTime   @map("date_of_birth")
  gender                  String
  admissionDate           DateTime   @default(now()) @map("admission_date")
  dischargedAt            DateTime?  @map("discharged_at")
  bedNumber               String     @map("bed_number")
  roomNumber              String?    @map("room_number")
  service                 String
  diagnosis               String
  allergies               String?
  isActive                Boolean    @default(true) @map("is_active")
  hospital                String
  attendingDoctor         String     @map("attending_doctor")
  bloodType               String?    @map("blood_type")
  emergencyContactName    String?    @map("emergency_contact_name")
  emergencyContactPhone   String?    @map("emergency_contact_phone")
  insuranceProvider       String?    @map("insurance_provider")
  insuranceNumber         String?    @map("insurance_number")
  weight                  Float?
  height                  Float?
  specialNotes            String?    @map("special_notes")
  dietType                String?    @map("diet_type")
  isolationPrecautions    String?    @map("isolation_precautions")
  createdAt               DateTime   @default(now()) @map("created_at")
  updatedAt               DateTime   @updatedAt @map("updated_at")

  soapNotes   soapNote[]
  tasks       task[]

  @@index([hospital, isActive])
  @@index([bedNumber, hospital])
  @@map("patients")
}

model soapNote {
  id                      String    @id @default(uuid())
  patientId               String    @map("patient_id")
  date                    DateTime  @default(now())
  chiefComplaint          String    @map("chief_complaint")
  historyOfPresentIllness String    @map("history_of_present_illness")
  vitalSigns              Json?     @map("vital_signs")
  physicalExam            String    @map("physical_exam")
  laboratoryResults       String?   @map("laboratory_results")
  imagingResults          String?   @map("imaging_results")
  assessment              String
  plan                    String
  medications             String?
  pendingStudies          String?   @map("pending_studies")
  authorId                String    @map("author_id")
  hospital                String
  patient                 patient   @relation(fields: [patientId], references: [id], onDelete: Cascade)
  createdAt               DateTime  @default(now()) @map("created_at")
  updatedAt               DateTime  @updatedAt @map("updated_at")

  @@index([patientId, date])
  @@map("soap_notes")
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TaskType {
  LABORATORY
  IMAGING
  CONSULT
  PROCEDURE
  MEDICATION
  OTHER
}

model task {
  id          String       @id @default(uuid())
  title       String
  description String?
  status      TaskStatus   @default(PENDING)
  priority    TaskPriority @default(MEDIUM)
  type        TaskType     @default(OTHER)
  patientId   String?      @map("patient_id")
  patient     patient?     @relation(fields: [patientId], references: [id], onDelete: SetNull)
  assignedTo  String       @map("assigned_to")
  assignee    medicosProfile @relation("AssignedTasks", fields: [assignedTo], references: [id])
  createdBy   String       @map("created_by")
  creator     medicosProfile @relation("CreatedTasks", fields: [createdBy], references: [id])
  dueDate     DateTime?    @map("due_date")
  completedAt DateTime?    @map("completed_at")
  hospital    String
  service     String?
  shift       String?
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")

  checklist   taskChecklistItem[]

  @@index([assignedTo, status])
  @@index([hospital, status])
  @@map("tasks")
}

model taskChecklistItem {
  id          String    @id @default(uuid())
  taskId      String    @map("task_id")
  task        task      @relation(fields: [taskId], references: [id], onDelete: Cascade)
  description String
  isCompleted Boolean   @default(false) @map("is_completed")
  completedAt DateTime? @map("completed_at")
  completedBy String?   @map("completed_by")
  order       Int       @default(0)
  createdAt   DateTime  @default(now()) @map("created_at")

  @@index([taskId])
  @@map("task_checklist_items")
}
